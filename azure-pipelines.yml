# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

strategy:
  matrix:
    linux-node8:
      imageName: 'ubuntu-latest'
      nodeVersion: '8.x'
    linux-node10:
      imageName: 'ubuntu-latest'
      nodeVersion: '10.x'
    mac-node8:
      imageName: 'macos-latest'
      nodeVersion: '8.x'
    mac-node10:
      imageName: 'macos-latest'
      nodeVersion: '10.x'
    windows-node8:
      imageName: 'windows-latest'
      nodeVersion: '8.x'
    windows-node10:
      imageName: 'windows-latest'
      nodeVersion: '10.x'

pool:
  vmImage: $(imageName)

trigger:
  branches:
    include:
      - master
      - greenkeeper/*
pr:
  - master

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: $(nodeVersion)
    displayName: 'Install Node.js'

  - script: npm run getenv:mkdir
    displayName: 'mkdir'

  - script: npm run getenv:mkdirp
    displayName: 'mkdir with -p'

  - script: npm run getenv:mkdirp2
    displayName: 'mkdir with -p existing folder'

  - script: npm run getenv:mkdirr
    displayName: 'mkdir with -p recursive'

  - script: npm run getenv:echo
    displayName: 'echo variable'

  - script: npm run getenv:echodef
    displayName: 'echo default variable'

  - script: npm run getenv:echoset
    displayName: 'echo set variable'

  - script: npm run getenv:copy
    displayName: 'copy env file'
# TODO: manage login to @azure/ng-deploy and az cli before enabling
#- script: bash -c "bash -c \"scripts/test.sh\""
#  displayName: 'Run e2e tests'
